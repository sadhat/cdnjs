define(["durandal/system","durandal/binder","knockout"],function(n,t,i){function w(n){var t=n[0];return t==="_"||t==="$"}function b(t){return!!(t&&t.nodeType!==undefined&&n.isNumber(t.nodeType))}function k(n){if(!n||b(n)||n.ko===i||n.jquery)return!1;var t=c.call(n);return l.indexOf(t)==-1&&!(n===!0||n===!1)}function f(n,t){var u=n.__observable__,i=!0,f,e;if(!u||!u.__full__)for(u=u||(n.__observable__={}),u.__full__=!0,a.forEach(function(r){n[r]=function(){i=!1;var n=p[r].apply(t,arguments);return i=!0,n}}),v.forEach(function(r){n[r]=function(){i&&t.valueWillMutate();var u=o[r].apply(n,arguments);return i&&t.valueHasMutated(),u}}),y.forEach(function(u){n[u]=function(){for(var s,f=0,e=arguments.length;f<e;f++)r(arguments[f]);return i&&t.valueWillMutate(),s=o[u].apply(n,arguments),i&&t.valueHasMutated(),s}}),n.splice=function(){for(var e,u=2,f=arguments.length;u<f;u++)r(arguments[u]);return i&&t.valueWillMutate(),e=o.splice.apply(n,arguments),i&&t.valueHasMutated(),e},f=0,e=n.length;f<e;f++)r(n[f])}function r(t){var r,o,h,u;if(k(t)&&(r=t.__observable__,!r||!r.__full__)){if(r=r||(t.__observable__={}),r.__full__=!0,n.isArray(t))h=i.observableArray(t),f(t,h);else for(u in t)w(u)||r[u]||(o=t[u],n.isFunction(o)||e(t,u,o));s&&n.log("Converted",t)}}function h(n,t,i){var u;n(t);u=n.peek();i?u?u.destroyAll||f(u,n):(u=[],n(u),f(u,n)):r(u)}function e(t,u,e){var o,s,c=t.__observable__||(t.__observable__={});if(e===undefined&&(e=t[u]),n.isArray(e))o=i.observableArray(e),f(e,o),s=!0;else if(typeof e=="function")if(i.isObservable(e))o=e;else return null;else n.isPromise(e)?(o=i.observable(),e.then(function(t){if(n.isArray(t)){var r=i.observableArray(t);f(t,r);t=r}o(t)})):(o=i.observable(e),r(e));return Object.defineProperty(t,u,{configurable:!0,enumerable:!0,get:o,set:i.isWriteableObservable(o)?function(t){t&&n.isPromise(t)?t.then(function(t){h(o,t,n.isArray(t))}):h(o,t,s)}:undefined}),c[u]=o,o}function d(t,r,u){var f={owner:t,deferEvaluation:!0},o;return typeof u=="function"?f.read=u:("value"in u&&n.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),typeof u.get!="function"&&n.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),f.read=u.get,f.write=u.set),o=i.computed(f),t[r]=o,e(t,r,o)}var u,c=Object.prototype.toString,l=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],a=["remove","removeAll","destroy","destroyAll","replace"],v=["pop","reverse","sort","shift","splice"],y=["push","unshift"],o=Array.prototype,p=i.observableArray.fn,s=!1;return u=function(n,t){var u,f,r;return n?(u=n.__observable__,u&&(f=u[t],f))?f:(r=n[t],i.isObservable(r))?r:e(n,t,r):null},u.defineProperty=d,u.convertProperty=e,u.convertObject=r,u.install=function(n){var i=t.binding;t.binding=function(n,t,u){u.applyBindings&&!u.skipConversion&&r(n);i(n,t)};s=n.logConversion},u});