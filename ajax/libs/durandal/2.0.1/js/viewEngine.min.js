define(["durandal/system","jquery"],function(n,t){var i;return i=t.parseHTML?function(n){return t.parseHTML(n)}:function(n){return t(n).get()},{viewExtension:".html",viewPlugin:"text",isViewUrl:function(n){return n.indexOf(this.viewExtension,n.length-this.viewExtension.length)!==-1},convertViewUrlToViewId:function(n){return n.substring(0,n.length-this.viewExtension.length)},convertViewIdToRequirePath:function(n){return this.viewPlugin+"!"+n+this.viewExtension},parseMarkup:i,processMarkup:function(n){var t=this.parseMarkup(n);return this.ensureSingleElement(t)},ensureSingleElement:function(n){var i,u,r,f;if(n.length==1)return n[0];for(i=[],u=0;u<n.length;u++)if(r=n[u],r.nodeType!=8){if(r.nodeType==3&&(f=/\S/.test(r.nodeValue),!f))continue;i.push(r)}return i.length>1?t(i).wrapAll('<div class="durandal-wrapper"><\/div>').parent().get(0):i[0]},createView:function(t){var i=this,r=this.convertViewIdToRequirePath(t);return n.defer(function(u){n.acquire(r).then(function(n){var r=i.processMarkup(n);r.setAttribute("data-view",t);u.resolve(r)}).fail(function(n){i.createFallbackView(t,r,n).then(function(n){n.setAttribute("data-view",t);u.resolve(n)})})}).promise()},createFallbackView:function(t,i){var r=this,u='View Not Found. Searched for "'+t+'" via path "'+i+'".';return n.defer(function(n){n.resolve(r.processMarkup('<div class="durandal-view-404">'+u+"<\/div>"))}).promise()}}});